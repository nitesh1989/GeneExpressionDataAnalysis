getwd()
getwd()
setwd("~/Documents/GeneExpressionDataAnalysis/affyData/")
getwd()
getwd()
setwd("~/Documents/GeneExpressionDataAnalysis/affyData/")
date()
rm(list=ls())
require(affy)
require(hgu95a.db)
load("./objs/affyData.rda")
class(dat)
class(dat.rma)
slotNames(dat)
slotNames(dat.rma)
dat.expr <- exprs(dat.rma)
dim(dat.expr)
$M = log_{2}(R/G) = log_{2}(R) - log_{2}(G)$
mypar <- function (nRow = 1, nCol = 1, ptsExp = 1) {
par(mar = c(2, 2, 2, 1))
par(oma = c(2, 1, 1, 1))
par(mfrow = c(nRow, nCol))
par(cex = ptsExp)
}
?plot
?cex
?par
nc <- ceiling(sqrt(ncol(dat.rma)))
nr <- ceiling(ncol(dat.rma)/nc)
nc
nr
dim(dat.rma)
mypar(nr,nc,0.5)
MAplot(dat[,],pairs=F,plot.method="smoothScatter")
bitmap(file="./figs/MApl.raw.png",width=20, height=10, res = 400)
mypar(nr,nc,0.5)
par(oma=c(2,1,1,1))
MAplot(dat[,],pairs=F,plot.method="smoothScatter")
dev.off()
mypar(nr,nc,0.5)
par(oma=c(2,1,1,1))
a <- exprs(dat.rma)
for (i in 1:ncol(a)){
ma.plot(A=((a[,i]+apply(a,1,median))/2),
M=(a[,i]-apply(a,1,median)),
show.statistics=TRUE,cex.main=1,
span=1/3, family.loess="gaussian", cex = 0.75,
plot.method="smoothScatter",add.loess = TRUE,
lwd = 2, lty = 2, loess.col = "red",ylim=c(-6,6),
main=paste(colnames(a)[i],
'\n vs pseudo-median reference chip'))
}
bitmap(file='./figs/MApl.rma.png',width=20,height=10,res=400)
mypar(nr,nc,0.5)
par(oma=c(2,1,1,1))
a <- exprs(dat.rma)
for (i in 1:ncol(a)){
ma.plot(A=((a[,i]+apply(a,1,median))/2),
M=(a[,i]-apply(a,1,median)),
show.statistics=TRUE,cex.main=1,
span=1/3, family.loess="gaussian", cex = 0.75,
plot.method="smoothScatter",add.loess = TRUE,
lwd = 2, lty = 2, loess.col = "red",ylim=c(-6,6),
main=paste(colnames(a)[i],
'vs pseudo-median reference chip'))
}
dev.off()
bitmap(file="./figs/ima2D.png",width=2*nr, height=2*nc, res = 144)
mypar(nr,nc,1) ; par(mar=c(1,1,1,1))
image(dat[,])
dev.off()
deg <- AffyRNAdeg(dat)
deg
str(deg)
bitmap(file="./figs/degRNA.png",width=5, height=5, res = 1000)
mypar(2,2,0.75)
plotAffyRNAdeg(deg,cols=c(1:ncol(dat.rma)))
plot(density(deg$slope),main="Slope")
boxplot(deg$slope,main="Slope")
### Close the device
dev.off()
dateOfScan <- protocolData(dat.rma)@data$ScanDate
dateOfScan
dateOfScan <- gsub(" .+", "", dateOfScan)
dateOfScan
boxplot(log2(exprs(dat)), col=1+as.numeric(dateOfScan))
dev.off()
require(affy)
require(limma)
require(hgu95a.db)
require(annotate)
hgu95a()
kegg <- as.list(hgu95aPATH2PROBE)
kegg
go <- as.list(hgu95aGO2ALLPROBES)
hgu95a()
head(do)
head(go)
geneSetTest(tG2$ID%in%kegg[[1]],tG2$t)
load("./objs/affyData.rda")
load("./objs/linearModel.rda")
tG2$ID
geneSetTest(tG2$ID%in%kegg[[1]],tG2$t)
geneSetTest(tG2$ID%in%kegg[[1]],tG2$t,alternative="down")
geneSetTest(tG2$ID%in%kegg[[1]],tG2$t,alternative="up")
barcodeplot(tG2$ID%in%kegg[[1]],tG2$t)
?barcodeplot
tG2$ID%in%kegg[[1]]
tG2$ID%in%kegg[[1]]
length(tG2$ID%in%kegg[[1]])
tG2$ID%in%kegg[[1]] == FALSE
table(tG2$ID%in%kegg[[1]])
barcodeplot(tG2$ID%in%kegg[[1]],tG2$t)
barcodeplot(as.numeric(tG2$ID%in%kegg[[1]]),tG2$t)
kegg2 <- kegg[!is.na(kegg)]
gse <- vector()
for (i in 1:length(kegg2)){
gse[i] <- geneSetTest(tG2$ID%in%kegg2[[i]],tG2$t)
names(gse)[i] <- names(kegg2)[i]
}
### This is an alternative
tmp <- sapply(kegg2, function(gs, stat, ids) {
geneSetTest(ids%in%gs,stat)
}, stat=tG2$t, ids=tG2$ID)
tmp
gse
tmp == gse
table(tmp == gse)
str(gse)
head(gse)
gse <- vector()
for (i in 1:length(kegg)){
if (all(!tG2$ID%in%kegg[[i]])) {
gse[i] <- NA
}else{
gse[i] <- geneSetTest(tG2$ID%in%kegg[[i]],tG2$t)
}
names(gse)[i] <- names(kegg)[i]
}
length(gse)
str(gse)
i=10
barcodeplot(tG2$ID%in%kegg[[i]],tG2$t)
all
?all
all(!tG2$ID%in%kegg[[i]])
all(tG2$ID%in%kegg[[i]])
args(geneSetTest)
library(GenomicRanges); library(Rsamtools);
source("http://bioconductor.org/biocLite.R")
###Get the list of available packages
installedPckgs <- installed.packages()[,"Package"]
###Define the list of desired libraries
pckgListBIOC <- c("BiocGenerics", "Biobase", "limma", "RTopper",
"org.Hs.eg.db", "AnnotationDbi", "annotate",
"multtest", "KEGG.db", "GO.db")
###Load the packages, install them from Bioconductor if needed
for (pckg in pckgListBIOC) {
if (! pckg %in% installedPckgs) {
biocLite(pckg, suppressUpdates=TRUE, ask=FALSE)
}
require(pckg, character.only=TRUE)
}
require(RTopper)
data(sepScores)
ls()
class(sepScores)
names(sepScores)
sapply(sepScores, class)
sapply(sepScores,dim)
data(sepScores)
ls()
require(RTopper)
data(sepScores)
ls()
class(sepScores)
names(sepScores)
sapply(sepScores, class)
sapply(sepScores,dim)
require(org.Hs.eg.db)
org.Hs.eg()
kegg <- as.list(org.Hs.egPATH2EG)
length(kegg)
str(kegg[1:5])
names(kegg)[1:5]
go <- as.list(org.Hs.egGO2ALLEGS)
length(go)
str(go[1:5])
names(go)[1:5]
numberOfFGSkegg <- 200
kegg <- lapply(kegg[sample(1:length(kegg),numberOfFGSkegg)],
function(x) unique(unlist(mget(x,org.Hs.egSYMBOL))))
str(kegg[1:5])
### Process GO: keep only Biological Process
length(go)
go <- go[ Ontology(names(go)) == "BP" ]
length(go)
numberOfFGSgo <- 200
go <- lapply(go[sample(1:length(go),numberOfFGSgo)],
function(x) unique(unlist(mget(x,org.Hs.egSYMBOL))))
str(go[1:5])
require(KEGG.db)
KEGG()
names(kegg) <- paste(names(kegg),unlist(mget(names(kegg),KEGGPATHID2NAME)),sep=".")
head(names(kegg), n=10)
fgsList <- list(go=go,kegg=kegg)
str(fgsList$go[1:5])
str(fgsList$kegg[1:5])
args(runBatchGSE)
testFile <- system.file("bam", "isowt5_13e.bam", package = "leeBamViews")
library(GenomicRanges); library(Rsamtools);
library(leeBamViews) # Load required libraries.
biocLite("leeBamViews")
library(leeBamViews) # Load required libraries.
testFile <- system.file("bam", "isowt5_13e.bam", package = "leeBamViews")
?readBamGappedAlignments
str(gseUP.sep[1:5])
head(gseABSsim.sep$dat.affy$go)
head(gseABSsim.sep$dat.affy$kegg)
library(knitr)
knitr::purl("01_raw2dge.Rmd")
source("01_raw2dge.R")
tG2ann2 <- merge(x=ann, y=tG2, by.x="PROBEID", by.y="ID", all.x=TRUE, all.y=FALSE)
ann <- select(x=hgu95a.db, keys=tG2$ID,cols=c("ENTREZID", "SYMBOL", "GENENAME"))
ann <- select(x=hgu95a.db, keys=tG2$ID,columns=c("ENTREZID", "SYMBOL", "GENENAME"))
tG2$ID
tG2 <- topTable(eb2.ls, coef=1, number=10, resort="logFC",genelist=rownames(eb2.ls))
tG2
tG2 <- tG2[order(tG2$ID),]
all(tG == tG2)
tG2 <- topTable(eb2.ls, coef=1, number=Inf, resort="logFC",genelist=rownames(eb2.ls))
# As you can see we need to add gene annotation!
str(tG2)
egid <- mget(tG2$ID, hgu95aENTREZID, ifnotfound=NA)
# Get Gene Symbol
sym <- mget(tG2$ID, hgu95aSYMBOL, ifnotfound=NA)
# Get Gene Name
nm <- mget(tG2$ID, hgu95aGENENAME, ifnotfound=NA)
tG2ann <- cbind(EGID=unlist(egid), SYMBOL=unlist(sym), GeneName=unlist(nm),
tG2, stringsAsFactors=FALSE)
tG2ann
str(tG2ann)
ann <- select(x=hgu95a.db, keys=tG2$ID,columns=c("ENTREZID", "SYMBOL", "GENENAME"))
dim(ann)
dim(tG2)
tG2ann2 <- merge(x=ann, y=tG2, by.x="PROBEID", by.y="ID", all.x=TRUE, all.y=FALSE)
### Let's check the results now
str(tG2ann2)
save(tG2, fit2.ls, eb2.ls, dMat2, cMat2, file="./objs/linearModel.rda")
tmp <- tG2ann2[ tG2ann2$adj.P.Val < 1e-3 , ]
tmp <- tmp[ , c(2, 1, 3:ncol(tmp)) ]
htmlpage(as.data.frame(tmp[ , 1]),
filename="./html/result.html",
othernames=as.data.frame(tmp[ , 2:ncol(tmp) ]),
table.head=colnames(tmp), digits=4)
featureData(dat)
featureData(dat)
tmp <- tG2ann2[ tG2ann2$adj.P.Val < 1e-3 , ]
### Reorder the columns to have ENTREZID as the first column:
### hyperlinks to the NCBI ENTREZ GENE database will be generated
tmp <- tmp[ , c(2, 1, 3:ncol(tmp)) ]
knitr::purl("03_dge2gsa.Rmd")
source("03_dge2gsa.R")
tG2$ID
kegg[[1]]
?barcodeplot
barcodeplot( tG2$t, tG2$ID %in% kegg[[1]])
?barcodeplot
roast(iset= sel, y=mat, design=newDmat, contrast=2)
roast
?roast
roast( y=mat, design=newDmat, contrast=2)
mat <- exprs(dat.rma)
sel <- rownames(mat)%in%kegg[[1]]
newDmat <- data.frame(
Intercept=1,
CellType=dMat2[,1]+dMat2[,2] + (-1* (dMat2[,3]+dMat2[,4]))
)
roast(iset= sel, y=mat, design=newDmat, contrast=2)
roast( y=mat, design=newDmat, contrast=2)
gse2 <- list()
for (i in 1:5){
sel <- rownames(mat)%in%kegg[[i]]
gse2[[i]] <- roast(sel, mat, design=newDmat, contrast=2)
names(gse2)[i] <- names(kegg)[i]
}
rownames(mat)
rownames(mat)%in%kegg[1]
rownames(mat)%in%kegg[[1]]
gse2 <- list()
for (i in 1:5){
sel <- rownames(mat)%in%kegg[[i]]
table(sel)
gse2[[i]] <- roast(sel, mat, design=newDmat, contrast=2)
names(gse2)[i] <- names(kegg)[i]
}
sel = rownames(mat)%in%kegg[[1]]
table(sel)
roast(sel, mat, design=newDmat, contrast=2)
gse2[[1]] <- roast(sel, mat, design=newDmat, contrast=2)
mat[sel]
sel
table(sel)
mat[sel]
length(mat[sel])
table(sel)
length(mat[sel,])
length(mat[,sel])
gse2 <- list()
for (i in 1:5){
sel <- rownames(mat)%in%kegg[[i]]
table(sel)
gse2[[i]] <- roast(mat[sel], design=newDmat, contrast=2)
names(gse2)[i] <- names(kegg)[i]
}
sel <- rownames(mat)%in%kegg[[i]]
table(sel)
gse2[[1]]
gse2[[1]] <- roast(mat[sel], design=newDmat, contrast=2)
newDmat
kegg
length(kegg)
dim(mat)
gse2 <- list()
for (i in 1:5){
sel <- rownames(mat)%in%kegg[[i]]
table(sel)
gse2[[i]] <- roast(mat, design=newDmat, contrast=2)
names(gse2)[i] <- names(kegg)[i]
}
hse2
gse2
mat = mat[which(sel)]
table(sel)
gse2[[i]] <- roast(mat, design=newDmat, contrast=2)
mat = mat[all(sel)]
sel <- rownames(mat)%in%kegg[[i]]
mat = mat[all(sel)]
